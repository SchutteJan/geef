<!doctype html>
<html lang="nl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Geef Jan Geld" />
        <link
            rel="icon"
            href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ðŸ’¸&lt;/text&gt;&lt;/svg&gt;"
        />
        <title>*** GEEF JAN GELD *** - Welkom!</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: "Comic Sans MS", "Comic Neue", serif;
                background-image: url("https://www.cameronsworld.net/img/content/14/bg.png");
                background-repeat: repeat;
                padding: 1rem;
                color: #000;
            }
            .header {
                text-align: center;
                margin-bottom: 20px;
                animation: blink 1s infinite;
            }
            @keyframes blink {
                0%,
                49% {
                    opacity: 1;
                }
                50%,
                100% {
                    opacity: 0;
                }
            }
            .money-gif {
                text-align: center;
                margin: 20px 0;
            }
            .container {
                background: #ffff00;
                padding: 2rem;
                border: 5px ridge #ff00ff;
                max-width: 600px;
                margin: 0 auto;
                box-shadow: 10px 10px 0px #000;
            }
            h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
                color: #ff0000;
                text-align: center;
                text-shadow: 2px 2px #00ffff;
                font-weight: bold;
            }
            marquee {
                font-size: 1.2rem;
                color: #0000ff;
                font-weight: bold;
                margin-bottom: 1rem;
            }
            .form-group {
                margin-bottom: 1rem;
            }
            .amount-group {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .amount-group .currency-symbol {
                font-size: 1.5rem;
                color: #ff0000;
                font-weight: bold;
            }
            .amount-group input {
                flex: 1;
            }
            label {
                display: block;
                margin-bottom: 0.5rem;
                color: #000;
                font-size: 1rem;
                font-weight: bold;
            }
            input {
                width: 100%;
                padding: 0.75rem;
                border: 3px solid #0000ff;
                font-size: 1rem;
                background: #fff;
            }
            input#amount {
                text-align: right;
                font-family: "Courier New", monospace;
                font-weight: bold;
            }
            button {
                width: 100%;
                padding: 1rem;
                background: linear-gradient(180deg, #ff0000 0%, #cc0000 100%);
                color: #ffff00;
                border: 3px outset #ff6666;
                font-size: 1.2rem;
                cursor: pointer;
                font-weight: bold;
                text-shadow: 1px 1px #000;
            }
            button:hover {
                background: linear-gradient(180deg, #cc0000 0%, #990000 100%);
            }
            button:active {
                border-style: inset;
            }
            .error {
                color: #ff0000;
                font-size: 1rem;
                margin-top: 0.5rem;
                font-weight: bold;
            }
            .visitor-counter {
                text-align: center;
                margin-top: 20px;
            }
            .visitor-counter img {
                display: block;
                margin: 0 auto;
            }
            .footer {
                text-align: center;
                margin-top: 20px;
                font-size: 0.9rem;
            }
            .under-construction {
                text-align: center;
                margin: 10px 0;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>*** WELKOM BIJ JAN'S TIKKIE EMPORIUM ***</h1>
        </div>

        <marquee scrollamount="9" behavior="scroll" direction="left">
            $$$ BELOFTE MAAKT SCHULD! $$$ ZO LANG DE VOORRAAD STREKT $$$ 100%
            BETROUWBAAR
        </marquee>

        <div class="container">
            <form id="payment-form">
                <div class="form-group">
                    <label for="amount">Bedrag</label>
                    <div class="amount-group">
                        <input
                            type="text"
                            id="amount"
                            name="amount"
                            placeholder="0,00"
                            inputmode="decimal"
                            required
                            autocomplete="off"
                        />
                        <span class="currency-symbol">â‚¬</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="description">Omschrijving (optioneel)</label>
                    <input
                        type="text"
                        id="description"
                        name="description"
                        placeholder="lunch"
                        autocomplete="off"
                        value="{{ if .Description }}{{ .Description }}{{ end }}"
                    />
                </div>
                <button type="submit">Betalen</button>
                <geef-form-validator></geef-form-validator>
            </form>
        </div>
        <div class="money-gif">
            <img
                src="https://www.animaties.com/data/media/100/geld-bewegende-animatie-0032.gif"
                border="0"
                alt="geld-bewegende-animatie-0032"
            />
        </div>

        <script>
            class GeefFormValidator extends HTMLElement {
                constructor() {
                    super();
                    this.modelValue = null; // Internal numeric value
                }

                connectedCallback() {
                    this.innerHTML = '<div id="error" class="error"></div>';

                    const form = this.closest("form");
                    const amountInput = form.querySelector("#amount");

                    // Parse amount from locale string (handles thousand separators)
                    const parseAmount = (str) => {
                        if (!str) return null;
                        // Remove currency symbols and non-breaking spaces
                        let cleaned = str.replace(/[â‚¬\s\u00A0]/g, "");

                        // Handle both . and , as decimal separators
                        // For nl-NL: thousands use . and decimals use ,
                        // But also accept . as decimal (like 10.50)

                        // Count occurrences
                        const dotCount = (cleaned.match(/\./g) || []).length;
                        const commaCount = (cleaned.match(/,/g) || []).length;

                        if (dotCount > 1 || commaCount > 1) {
                            // Multiple dots or commas - treat dots as thousand separators
                            cleaned = cleaned
                                .replace(/\./g, "")
                                .replace(",", ".");
                        } else if (dotCount === 1 && commaCount === 1) {
                            // Both present - last one is decimal
                            const dotPos = cleaned.lastIndexOf(".");
                            const commaPos = cleaned.lastIndexOf(",");
                            if (dotPos > commaPos) {
                                // . is decimal, , is thousand
                                cleaned = cleaned.replace(/,/g, "");
                            } else {
                                // , is decimal, . is thousand
                                cleaned = cleaned
                                    .replace(/\./g, "")
                                    .replace(",", ".");
                            }
                        } else if (commaCount === 1) {
                            // Only comma - it's the decimal separator
                            cleaned = cleaned.replace(",", ".");
                        }
                        // If only dot, leave it as is (already valid for parseFloat)

                        const num = parseFloat(cleaned);
                        return isNaN(num) ? null : num;
                    };

                    // Format amount on blur
                    amountInput.addEventListener("blur", (e) => {
                        const value = e.target.value.trim();
                        if (!value) return;

                        const amount = parseAmount(value);
                        if (amount !== null && amount > 0) {
                            this.modelValue = amount;
                            // Format as number with nl-NL locale (no currency symbol)
                            const formatted = new Intl.NumberFormat("nl-NL", {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2,
                            }).format(amount);
                            e.target.value = formatted;
                        }
                    });

                    // Strip formatting on focus for easy editing
                    amountInput.addEventListener("focus", (e) => {
                        if (this.modelValue !== null) {
                            e.target.value = this.modelValue
                                .toFixed(2)
                                .replace(".", ",");
                        }
                    });

                    form.addEventListener("submit", (e) => {
                        e.preventDefault();
                        this.handleSubmit(form);
                    });
                }

                handleSubmit(form) {
                    const amountInput = form.querySelector("#amount");
                    const descriptionInput = form.querySelector("#description");
                    const errorDiv = this.querySelector("#error");

                    errorDiv.textContent = "";

                    // Parse amount from locale string (handles thousand separators)
                    const parseAmount = (str) => {
                        if (!str) return null;
                        // Remove currency symbols and non-breaking spaces
                        let cleaned = str.replace(/[â‚¬\s\u00A0]/g, "");

                        // Handle both . and , as decimal separators
                        // For nl-NL: thousands use . and decimals use ,
                        // But also accept . as decimal (like 10.50)

                        // Count occurrences
                        const dotCount = (cleaned.match(/\./g) || []).length;
                        const commaCount = (cleaned.match(/,/g) || []).length;

                        if (dotCount > 1 || commaCount > 1) {
                            // Multiple dots or commas - treat dots as thousand separators
                            cleaned = cleaned
                                .replace(/\./g, "")
                                .replace(",", ".");
                        } else if (dotCount === 1 && commaCount === 1) {
                            // Both present - last one is decimal
                            const dotPos = cleaned.lastIndexOf(".");
                            const commaPos = cleaned.lastIndexOf(",");
                            if (dotPos > commaPos) {
                                // . is decimal, , is thousand
                                cleaned = cleaned.replace(/,/g, "");
                            } else {
                                // , is decimal, . is thousand
                                cleaned = cleaned
                                    .replace(/\./g, "")
                                    .replace(",", ".");
                            }
                        } else if (commaCount === 1) {
                            // Only comma - it's the decimal separator
                            cleaned = cleaned.replace(",", ".");
                        }
                        // If only dot, leave it as is (already valid for parseFloat)

                        const num = parseFloat(cleaned);
                        return isNaN(num) ? null : num;
                    };

                    const amountValue = amountInput.value.trim();
                    if (!amountValue) {
                        errorDiv.textContent = "Vul een bedrag in";
                        return;
                    }

                    const amount = parseAmount(amountValue);
                    if (amount === null) {
                        errorDiv.textContent =
                            "Ongeldig bedrag. Gebruik formaat: 10 of 10,50";
                        return;
                    }

                    if (amount <= 0) {
                        errorDiv.textContent = "Bedrag moet groter zijn dan 0";
                        return;
                    }

                    // Store the validated amount
                    this.modelValue = amount;

                    // Construct redirect path with normalized amount (dot decimal)
                    const normalizedAmount = amount.toFixed(2);
                    let path = "/" + normalizedAmount;

                    const description = descriptionInput.value.trim();
                    if (description) {
                        path += "/" + encodeURIComponent(description);
                    }

                    // Redirect to payment path
                    window.location.href = path;
                }
            }

            customElements.define("geef-form-validator", GeefFormValidator);
        </script>

        <div class="visitor-counter">
            <p
                style="
                    color: #000fff;
                    font-family: &quot;Courier New&quot;, monospace;
                    margin-top: 5px;
                    font-size: 0.9rem;
                "
            >
                U bent bezoeker nummer
                <span
                    style="
                        background: #000;
                        color: #ff0000;
                        font-weight: bold;
                        padding: 4px 8px;
                        font-family: &quot;Courier New&quot;, monospace;
                        letter-spacing: 3px;
                        border: 2px inset #333;
                        display: inline-block;
                        font-size: 1.1rem;
                    "
                    >133769</span
                >!
            </p>
        </div>

        <div class="footer">
            <p style="color: #0000ff; font-weight: bold">
                Best bekeken in Internet Explorer 6.0
            </p>
            <p style="color: #ff0000; margin-top: 5px">
                Â© 2003
                <a href="https://github.com/SchutteJan/geef" target="_blank"
                    >Geef</a
                >
                - Alle rechten voorbehouden
            </p>
        </div>
    </body>
</html>
